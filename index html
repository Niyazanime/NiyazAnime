<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NIYAZANIME | PLATINUM EDITION</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;500;800&family=Bebas+Neue&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --accent: #ff0000;
            --bg-dark: #080808;
            --bg-card: #121212;
            --glass: rgba(255, 255, 255, 0.05);
            --text-main: #ffffff;
            --text-dim: #a0a0a0;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { 
            margin: 0; background: var(--bg-dark); color: var(--text-main); 
            font-family: 'Manrope', sans-serif; overflow-x: hidden; 
        }

        /* --- AUTH SYSTEM --- */
        #auth-gate {
            position: fixed; inset: 0; background: var(--bg-dark); z-index: 10000;
            display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 30px;
        }
        .auth-card {
            width: 100%; max-width: 380px; background: var(--bg-card); padding: 40px 25px;
            border-radius: 24px; border: 1px solid var(--glass); text-align: center;
        }
        .auth-logo { font-family: 'Bebas Neue'; font-size: 50px; color: var(--accent); letter-spacing: 4px; margin-bottom: 30px; }
        .input-group { margin-bottom: 20px; position: relative; }
        input[type="text"], input[type="password"] {
            width: 100%; padding: 18px; background: #1a1a1a; border: 1px solid #333;
            border-radius: 12px; color: white; font-size: 16px; transition: 0.3s;
        }
        input:focus { border-color: var(--accent); box-shadow: 0 0 15px rgba(255,0,0,0.2); }
        .main-btn {
            width: 100%; padding: 18px; background: var(--accent); color: white; border: none;
            border-radius: 12px; font-weight: 800; font-size: 16px; cursor: pointer; transition: 0.3s;
        }
        .main-btn:active { transform: scale(0.96); opacity: 0.9; }

        /* --- LAYOUT --- */
        header { 
            position: sticky; top: 0; z-index: 500; background: rgba(8,8,8,0.8); 
            backdrop-filter: blur(20px); padding: 15px 20px; display: flex; 
            justify-content: space-between; align-items: center; border-bottom: 1px solid var(--glass);
        }
        .logo-sm { font-family: 'Bebas Neue'; font-size: 28px; color: var(--accent); }
        .profile-trigger { width: 35px; height: 35px; border-radius: 50%; background: var(--accent); display: flex; align-items: center; justify-content: center; font-weight: bold; }

        .content { padding: 20px; padding-bottom: 100px; }
        .page { display: none; animation: pageIn 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
        .page.active { display: block; }
        @keyframes pageIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }

        /* --- ANIME ENGINE --- */
        .section-h { font-size: 22px; font-weight: 800; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; }
        .section-h::before { content: ''; width: 4px; height: 24px; background: var(--accent); border-radius: 2px; }
        
        .anime-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; }
        .anime-card { 
            background: var(--bg-card); border-radius: 18px; overflow: hidden; 
            border: 1px solid var(--glass); position: relative; transition: 0.3s;
        }
        .anime-card:active { transform: scale(0.98); }
        .poster-wrapper { position: relative; width: 100%; aspect-ratio: 2/3; }
        .poster-wrapper img { width: 100%; height: 100%; object-fit: cover; }
        .rating-badge { 
            position: absolute; top: 10px; left: 10px; background: rgba(0,0,0,0.7);
            backdrop-filter: blur(5px); padding: 4px 8px; border-radius: 6px; 
            color: #ffcc00; font-size: 11px; font-weight: 800;
        }
        .anime-info { padding: 12px; }
        .anime-title { font-size: 14px; font-weight: 700; margin-bottom: 5px; height: 38px; overflow: hidden; }
        .anime-meta { font-size: 11px; color: var(--text-dim); }

        /* --- REAL CHAT UI --- */
        .chat-container { height: calc(100vh - 250px); display: flex; flex-direction: column; background: #0c0c0c; border-radius: 20px; border: 1px solid var(--glass); overflow: hidden; }
        #chat-flow { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 12px; scroll-behavior: smooth; }
        .message { max-width: 80%; padding: 12px 16px; border-radius: 16px; font-size: 14px; position: relative; animation: msgIn 0.3s ease; }
        .message.mine { align-self: flex-end; background: var(--accent); color: white; border-bottom-right-radius: 4px; }
        .message.others { align-self: flex-start; background: var(--bg-card); border-bottom-left-radius: 4px; }
        .m-sender { font-size: 10px; font-weight: 800; margin-bottom: 4px; display: block; opacity: 0.8; }
        .m-time { font-size: 9px; margin-top: 5px; display: block; opacity: 0.6; text-align: right; }
        .chat-input-bar { padding: 15px; background: #111; display: flex; gap: 10px; align-items: center; }
        #msg-field { flex: 1; background: #1a1a1a; border: none; padding: 14px; border-radius: 12px; color: white; }

        /* --- PLAYER OVERLAY --- */
        #theater-mode { 
            position: fixed; inset: 0; background: #000; z-index: 2000; 
            display: none; flex-direction: column; 
        }
        .player-head { padding: 20px; display: flex; justify-content: space-between; align-items: center; }
        .video-box { width: 100%; aspect-ratio: 16/9; background: #111; position: relative; display: flex; align-items: center; justify-content: center; }
        .play-icon-huge { font-size: 60px; color: var(--accent); opacity: 0.5; }

        /* --- NAV BAR --- */
        .bottom-nav { 
            position: fixed; bottom: 0; width: 100%; height: 80px; 
            background: rgba(8,8,8,0.9); backdrop-filter: blur(20px);
            display: flex; border-top: 1px solid var(--glass); z-index: 1000;
        }
        .nav-link { 
            flex: 1; display: flex; flex-direction: column; align-items: center; 
            justify-content: center; gap: 5px; color: var(--text-dim); 
            font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px;
        }
        .nav-link.active { color: var(--accent); }
        .nav-link span { font-size: 22px; }

        @keyframes msgIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
    </style>
</head>
<body>

    <div id="auth-gate">
        <div class="auth-card">
            <div class="auth-logo">NIYAZANIME</div>
            <div class="input-group">
                <input type="text" id="log-user" placeholder="–í–∞—à –ª–æ–≥–∏–Ω">
            </div>
            <div class="input-group">
                <input type="password" id="log-pass" placeholder="–°–µ–∫—Ä–µ—Ç–Ω—ã–π –ø–∞—Ä–æ–ª—å">
            </div>
            <button class="main-btn" onclick="Core.handleAuth()">–û–¢–ö–†–´–¢–¨ –î–û–°–¢–£–ü</button>
            <p id="auth-error" style="color: var(--accent); font-size: 12px; margin-top: 15px; display: none;">–û—à–∏–±–∫–∞: –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ</p>
        </div>
    </div>

    <div id="app-root" style="display: none;">
        <header>
            <div class="logo-sm">NIYAZANIME</div>
            <div class="profile-trigger" id="p-avatar">N</div>
        </header>

        <div class="content">
            <div id="view-home" class="page active">
                <div class="section-h">–í –¢–†–ï–ù–î–ï –°–ï–ì–û–î–ù–Ø</div>
                <div class="anime-grid" id="main-catalog"></div>
            </div>

            <div id="view-search" class="page">
                <div class="section-h">–ì–õ–û–ë–ê–õ–¨–ù–´–ô –ü–û–ò–°–ö</div>
                <div class="input-group">
                    <input type="text" id="search-engine" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ, –≥–æ–¥ –∏–ª–∏ –∂–∞–Ω—Ä..." oninput="Core.search()">
                </div>
                <div class="anime-grid" id="search-res"></div>
            </div>

            <div id="view-chat" class="page">
                <div class="section-h">–û–ë–õ–ê–ß–ù–´–ô –ß–ê–¢</div>
                <div class="chat-container">
                    <div id="chat-flow"></div>
                    <div class="chat-input-bar">
                        <input type="text" id="msg-field" placeholder="–ù–∞–ø–∏—Å–∞—Ç—å –≤—Å–µ–º..." onkeypress="if(event.key==='Enter')Core.sendMsg()">
                        <button onclick="Core.sendMsg()" style="background: var(--accent); border:none; width:45px; height:45px; border-radius:12px; color:white;">‚û§</button>
                    </div>
                </div>
            </div>
        </div>

        <nav class="bottom-nav">
            <div class="nav-link active" onclick="Core.switchPage('view-home', this)"><span>üè†</span>–î–æ–º</div>
            <div class="nav-link" onclick="Core.switchPage('view-search', this)"><span>üîç</span>–ü–æ–∏—Å–∫</div>
            <div class="nav-link" onclick="Core.switchPage('view-chat', this)"><span>üí¨</span>–ß–∞—Ç</div>
            <div class="nav-link" onclick="Core.logout()"><span>üö™</span>–í—ã—Ö–æ–¥</div>
        </nav>
    </div>

    <div id="theater-mode">
        <div class="player-head">
            <div style="font-weight: 800; font-size: 18px;" id="playing-title">Loading...</div>
            <div onclick="Core.closePlayer()" style="font-size: 24px; cursor: pointer;">‚úï</div>
        </div>
        <div class="video-box">
            <div class="play-icon-huge">‚ñ∂</div>
            <div style="position:absolute; bottom:20px; font-size:12px; color:#555;">IPTV STREAM SERVER #1</div>
        </div>
        <div style="padding: 20px;">
            <div style="color: #46d369; font-weight: 800; margin-bottom: 10px;">98% MATCH</div>
            <p id="playing-desc" style="color: var(--text-dim); font-size: 14px; line-height: 1.6;">–ó–∞–≥—Ä—É–∑–∫–∞ –æ–ø–∏—Å–∞–Ω–∏—è –∏ –¥–∞–Ω–Ω—ã—Ö —Å —Å–µ—Ä–≤–µ—Ä–∞...</p>
            <button class="main-btn" style="background: #222;">–°–ö–ê–ß–ê–¢–¨ –í 4K</button>
        </div>
    </div>

    <script>
        // --- CORE ENGINE ---
        const Core = {
            db: null,
            user: null,
            animeData: [
                { id: 1, title: "–¢–≤–æ–µ –∏–º—è", year: "2016", rating: "9.8", img: "2TP018QS51eFzJPCgvHCYg.png", desc: "–ò—Å—Ç–æ—Ä–∏—è –æ –¥–≤—É—Ö –ø–æ–¥—Ä–æ—Å—Ç–∫–∞—Ö, –∫–æ—Ç–æ—Ä—ã–µ –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞—é—Ç, —á—Ç–æ –º–µ–∂–¥—É –Ω–∏–º–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç —Å—Ç—Ä–∞–Ω–Ω–∞—è –∏ –Ω–µ–æ–±—ä—è—Å–Ω–∏–º–∞—è —Å–≤—è–∑—å." },
                { id: 2, title: "–£–Ω–µ—Å–µ–Ω–Ω—ã–µ –ø—Ä–∏–∑—Ä–∞–∫–∞–º–∏", year: "2001", rating: "8.6", img: "2026-01-30-08-13-12-images.jpg", desc: "–¢–∏—Ö–∏—Ä–æ —Å —Ä–æ–¥–∏—Ç–µ–ª—è–º–∏ –ø–µ—Ä–µ–µ–∑–∂–∞–µ—Ç –≤ –Ω–æ–≤—ã–π –¥–æ–º, –Ω–æ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –º–∏—Ä –ø—Ä–∏–∑—Ä–∞–∫–æ–≤ –∏ –±–æ–≥–æ–≤." },
                { id: 3, title: "–£—á–µ–Ω–∏–∫ —á—É–¥–æ–≤–∏—â–∞", year: "2015", rating: "7.7", img: "i.jpeg", desc: "–ú–∞–ª—å—á–∏–∫-—Å–∏—Ä–æ—Ç–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —É—á–µ–Ω–∏–∫–æ–º –≤–µ–ª–∏–∫–æ–≥–æ –≤–æ–∏–Ω–∞-—á—É–¥–æ–≤–∏—â–∞ –∏–∑ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–≥–æ –º–∏—Ä–∞." }
            ],

            init() {
                const config = { databaseURL: "https://niyaz-7c412-default-rtdb.firebaseio.com/" };
                firebase.initializeApp(config);
                this.db = firebase.database();
                this.checkSession();
                this.renderCatalog(this.animeData, 'main-catalog');
            },

            checkSession() {
                const saved = localStorage.getItem('niyaz_session');
                if(saved) {
                    this.user = JSON.parse(saved);
                    this.launchApp();
                }
            },

            handleAuth() {
                const u = document.getElementById('log-user').value.trim();
                const p = document.getElementById('log-pass').value.trim();
                if(u.length > 2 && p.length > 3) {
                    this.user = { name: u, joined: Date.now() };
                    localStorage.setItem('niyaz_session', JSON.stringify(this.user));
                    this.launchApp();
                } else {
                    document.getElementById('auth-error').style.display = 'block';
                }
            },

            launchApp() {
                document.getElementById('auth-gate').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('auth-gate').style.display = 'none';
                    document.getElementById('app-root').style.display = 'block';
                    document.getElementById('p-avatar').innerText = this.user.name[0].toUpperCase();
                    this.listenChat();
                }, 500);
            },

            renderCatalog(data, target) {
                const container = document.getElementById(target);
                container.innerHTML = data.map(anime => `
                    <div class="anime-card" onclick="Core.openPlayer(${anime.id})">
                        <div class="poster-wrapper">
                            <div class="rating-badge">‚òÖ ${anime.rating}</div>
                            <img src="${anime.img}" onerror="this.src='https://via.placeholder.com/200x300?text=Wait...'">
                        </div>
                        <div class="anime-info">
                            <div class="anime-title">${anime.title}</div>
                            <div class="anime-meta">${anime.year} ‚Ä¢ Movie</div>
                        </div>
                    </div>
                `).join('');
            },

            switchPage(id, el) {
                document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
                document.querySelectorAll('.nav-link').forEach(n => n.classList.remove('active'));
                document.getElementById(id).classList.add('active');
                el.classList.add('active');
            },

            search() {
                const q = document.getElementById('search-engine').value.toLowerCase();
                const filtered = this.animeData.filter(a => a.title.toLowerCase().includes(q) || a.year.includes(q));
                this.renderCatalog(filtered, 'search-res');
            },

            openPlayer(id) {
                const anime = this.animeData.find(a => a.id === id);
                document.getElementById('playing-title').innerText = anime.title;
                document.getElementById('playing-desc').innerText = anime.desc;
                document.getElementById('theater-mode').style.display = 'flex';
            },

            closePlayer() {
                document.getElementById('theater-mode').style.display = 'none';
            },

            sendMsg() {
                const input = document.getElementById('msg-field');
                if(input.value.trim()) {
                    this.db.ref('global_chat').push({
                        user: this.user.name,
                        text: input.value,
                        ts: Date.now()
                    });
                    input.value = "";
                }
            },

            listenChat() {
                this.db.ref('global_chat').limitToLast(40).on('value', snap => {
                    const flow = document.getElementById('chat-flow');
                    flow.innerHTML = "";
                    snap.forEach(m => {
                        const d = m.val();
                        const isMine = d.user === this.user.name ? 'mine' : 'others';
                        const time = new Date(d.ts).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
                        flow.innerHTML += `
                            <div class="message ${isMine}">
                                <span class="m-sender">${d.user}</span>
                                ${d.text}
                                <span class="m-time">${time}</span>
                            </div>
                        `;
                    });
                    flow.scrollTop = flow.scrollHeight;
                });
            },

            logout() {
                localStorage.removeItem('niyaz_session');
                location.reload();
            }
        };

        Core.init();
    </script>
</body>
</html>
